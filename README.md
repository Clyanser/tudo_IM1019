# Tudo IM - 基于go-zero的微服务即时通讯系统

## 项目简介

Tudo IM是一个基于go-zero框架开发的高性能、可扩展的微服务即时通讯系统。系统采用微服务架构，包含用户服务、聊天服务、群组服务、文件服务等核心模块，支持多种消息类型和功能，提供稳定可靠的即时通讯能力。

## 技术栈

- **开发语言**: Go 1.24
- **核心框架**: go-zero v1.8.4
- **数据存储**: MySQL、Redis
- **服务注册与发现**: etcd
- **消息通信**: gRPC、WebSocket
- **ORM框架**: GORM
- **API文档**: go-zero自带API工具
- **认证**: JWT

## 系统架构

系统采用微服务架构设计，主要包括以下几个部分：

1. **API网关层**: 统一入口，负责路由分发、认证授权等
2. **服务层**: 包含多个微服务（用户、聊天、群组、文件等）
3. **数据层**: 包括MySQL、Redis、etcd等存储组件

![系统架构图]

### 微服务划分

- **tudoIM_auth**: 认证服务，负责用户登录、注册、身份验证等
- **tudoIM_user**: 用户服务，管理用户信息、好友关系等
- **tudoIM_chat**: 聊天服务，处理消息的发送、存储和获取
- **tudoIM_group**: 群组服务，管理群组信息、群成员和群消息
- **tudoIM_file**: 文件服务，处理文件上传、下载等
- **tudoIM_gateway**: API网关，统一入口，处理请求路由和负载均衡

## 核心功能

### 用户模块
- 用户注册、登录、登出
- 用户信息管理（昵称、头像、个性签名等）
- 好友关系管理（添加、删除、验证）
- 用户配置管理

### 聊天模块
- 私聊消息发送与接收
- 多种消息类型支持（文本、图片、视频、文件、语音等）
- 消息撤回、回复、引用功能
- 消息预览和系统消息

### 群组模块
- 群组创建与管理
- 群成员管理（加入、退出、踢出等）
- 群消息发送与接收
- 群公告、群设置
- 群验证机制

### 文件模块
- 文件上传与下载
- 文件类型支持（图片、视频、文档等）
- 文件预览

### 网关模块
- 请求路由和负载均衡
- 服务发现
- 统一认证授权
- 请求转发

## 数据库设计

系统采用MySQL作为主要数据存储，Redis用于缓存和会话管理，etcd用于服务注册与发现。

### 主要数据表

- **UserModel**: 用户信息表
- **FriendModel**: 好友关系表
- **FriendVerifyModel**: 好友验证记录表
- **UserConfModel**: 用户配置表
- **ChatModel**: 聊天消息表
- **TopUserModel**: 置顶用户表
- **UserChatDeleteModel**: 用户删除聊天记录表
- **GroupModel**: 群组信息表
- **GroupMemberModel**: 群成员表
- **GroupMsgModel**: 群消息表
- **GroupVerifyModel**: 群验证表
- **FileModel**: 文件信息表

## 快速开始

### 环境要求
- Go 1.24+
- MySQL 5.7+
- Redis 6.0+
- etcd 3.5+

### 初始化数据库

```bash
# 运行初始化脚本创建数据库表
go run main.go -db
```

### 启动服务

```bash
# 启动认证服务
cd tudoIM_auth/auth_api
go run auth.go

# 启动用户服务
cd tudoIM_user/user_api
go run users.go

# 启动聊天服务
cd tudoIM_chat/chat_api
go run chats.go

# 启动文件服务
cd tudoIM_file/file_api
go run file.go

# 启动网关服务
cd tudoIM_gateway
go run gateway.go
```

## 配置说明

系统配置文件主要位于各服务的etc目录下，主要配置项包括：

- 服务监听地址和端口
- 数据库连接信息
- Redis连接信息
- etcd连接信息
- 日志配置

## API文档

系统使用go-zero框架自带的API工具生成API文档，各服务的API定义文件位于对应的api目录下，例如：

- tudoIM_auth/auth_api/auth_api.api
- tudoIM_user/user_api/user_api.api
- tudoIM_chat/chat_api/chat_api.api
- tudoIM_file/file_api/file_api.api

## 开发说明

### 目录结构

```
├── common/             # 公共组件和模型
├── core/               # 核心配置和初始化
├── main.go             # 项目入口文件
├── template/           # 代码生成模板
├── tudoIM_auth/        # 认证服务
├── tudoIM_chat/        # 聊天服务
├── tudoIM_file/        # 文件服务
├── tudoIM_gateway/     # API网关
├── tudoIM_group/       # 群组服务
├── tudoIM_settings/    # 设置服务
├── tudoIM_user/        # 用户服务
└── utils/              # 工具函数
```

### 开发流程

1. 定义API接口（.api文件）
2. 使用goctl工具生成代码
3. 实现业务逻辑
4. 配置服务并启动

## 注意事项

1. 确保MySQL、Redis、etcd服务正常运行
2. 首次启动前需要运行main.go -db初始化数据库
3. 各服务需要注册到etcd以便网关发现
4. 生产环境需要修改配置文件中的连接信息和密钥

## 未来优化方向

### 性能优化
1. **消息存储优化**: 引入分库分表或时序数据库，优化海量消息的存储和检索性能
2. **缓存策略改进**: 优化Redis缓存策略，减少数据库访问压力
3. **异步处理**: 更多使用消息队列处理异步任务，提高系统吞吐量
4. **WebSocket连接池**: 实现WebSocket连接池管理，优化长连接性能

### 功能增强
1. **离线消息**: 完善离线消息存储和推送机制
2. **消息撤回与删除**: 优化消息撤回和删除功能，支持批量操作
3. **多端同步**: 实现多端登录和消息同步
4. **阅后即焚**: 添加阅后即焚消息功能
5. **消息搜索**: 实现全文检索功能
6. **富媒体消息**: 增强图片、视频、语音等富媒体消息的处理能力

### 安全性
1. **端到端加密**: 实现消息端到端加密
2. **风控系统**: 完善内容审核和风控系统
3. **敏感操作二次验证**: 对敏感操作添加二次验证机制
4. **安全审计**: 完善系统日志和安全审计功能

### 扩展性
1. **容器化部署**: 提供Docker和Kubernetes部署方案
2. **服务网格**: 引入服务网格架构，提升服务治理能力
3. **多语言支持**: 支持多语言客户端接入
4. **插件系统**: 设计插件系统，支持功能扩展

### 运维与监控
1. **监控告警**: 完善系统监控和告警机制
2. **日志聚合**: 引入ELK等日志聚合系统
3. **链路追踪**: 完善分布式链路追踪
4. **容量规划**: 提供性能测试报告和容量规划建议

## License

MIT License

## 致谢

感谢go-zero团队提供的优秀微服务框架，以及所有为此项目做出贡献的开发者。